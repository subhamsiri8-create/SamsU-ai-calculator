<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Infinity Calc AI</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/12.4.0/math.js"></script>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <style>
        :root {
            --bg: #000000;
            --panel: #0a0a0a;
            --border: #333;
            --text: #e5e5e5;
            --accent: #00ffa3;
            --error: #ff4444;
        }
        body {
            font-family: 'Courier New', monospace;
            background: var(--bg);
            color: var(--text);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
        }
        .main-window {
            width: 100%;
            max-width: 900px;
            background: var(--panel);
            border: 1px solid var(--border);
            border-radius: 12px;
            box-shadow: 0 0 40px rgba(0, 255, 163, 0.05);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        .screen {
            padding: 30px;
            border-bottom: 1px solid var(--border);
            min-height: 100px;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            align-items: flex-end;
        }
        .query-echo { font-size: 0.9rem; color: #666; margin-bottom: 10px; }
        .answer { font-size: 2.5rem; color: var(--accent); font-weight: bold; word-wrap: break-word; text-align: right;}
        
        .input-area {
            display: flex;
            border-top: 1px solid var(--border);
        }
        input {
            flex: 1;
            background: #111;
            border: none;
            color: white;
            padding: 20px;
            font-size: 1.2rem;
            outline: none;
            font-family: 'Courier New', monospace;
        }
        button#run {
            background: var(--accent);
            color: black;
            border: none;
            padding: 0 30px;
            font-weight: bold;
            cursor: pointer;
            font-size: 1.2rem;
        }
        button#run:hover { background: #00cc82; }

        .suggestions {
            display: flex;
            gap: 10px;
            padding: 10px;
            background: #050505;
            overflow-x: auto;
        }
        .chip {
            background: #222;
            color: #888;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.8rem;
            white-space: nowrap;
            cursor: pointer;
            border: 1px solid #333;
        }
        .chip:hover { border-color: var(--accent); color: var(--accent); }

        #plot-box { width: 100%; height: 300px; display: none; background: #000; }
        
        .fallback-btn {
            background: #333; color: white; border: 1px solid white; 
            padding: 5px 10px; margin-top: 5px; cursor: pointer; text-decoration: none;
            font-size: 0.8rem; display: inline-block;
        }
    </style>
</head>
<body>

<div class="main-window">
    <div class="screen">
        <div class="query-echo" id="echo">Waiting for input...</div>
        <div class="answer" id="result">0</div>
        <div id="plot-box"></div>
    </div>

    <div class="suggestions">
        <div class="chip" onclick="setInput('mass_earth')">Earth Mass</div>
        <div class="chip" onclick="setInput('Au')">Gold Mass</div>
        <div class="chip" onclick="setInput('c')">Speed of Light</div>
        <div class="chip" onclick="setInput('100 usd to eur')">Currency</div>
        <div class="chip" onclick="setInput('plot(sin(x))')">Graph</div>
        <div class="chip" onclick="setInput('solve(2x=10)')">Algebra</div>
    </div>

    <div class="input-area">
        <input type="text" id="input" placeholder="Ask anything (e.g. 'What is the mass of the moon?')" autocomplete="off">
        <button id="run" onclick="solve()">ASK</button>
    </div>
</div>

<script>
    const parser = math.parser();
    const resultEl = document.getElementById('result');
    const echoEl = document.getElementById('echo');
    const inputEl = document.getElementById('input');
    const plotBox = document.getElementById('plot-box');

    // 1. LOAD KNOWLEDGE BASE (The "Brain")
    function loadKnowledge() {
        // Physics
        parser.evaluate('c = 2.99792e8 m/s');
        parser.evaluate('G = 6.674e-11');
        parser.evaluate('h = 6.626e-34');
        parser.evaluate('g = 9.80665 m/s^2'); // Earth Gravity
        
        // Solar System
        parser.evaluate('mass_earth = 5.972e24 kg');
        parser.evaluate('radius_earth = 6371 km');
        parser.evaluate('mass_sun = 1.989e30 kg');
        parser.evaluate('mass_moon = 7.347e22 kg');
        parser.evaluate('dist_sun = 149600000 km'); // 1 AU

        // Periodic Table (Atomic Mass)
        parser.evaluate('H = 1.008'); parser.evaluate('He = 4.002');
        parser.evaluate('C = 12.011'); parser.evaluate('O = 15.999');
        parser.evaluate('Au = 196.97'); parser.evaluate('Fe = 55.845');
        parser.evaluate('U = 238.03');

        // Common Constants
        parser.evaluate('pi = 3.14159265359');
        parser.evaluate('e = 2.718281828');
        parser.evaluate('phi = 1.618033988'); // Golden Ratio
    }
    loadKnowledge();

    // 2. NATURAL LANGUAGE CLEANER
    function cleanInput(text) {
        let clean = text.toLowerCase();
        // Remove conversational filler
        const fillers = ['what is', 'calculate', 'solve', 'how much is', 'tell me', 'the', 'of', 'please', '?', '='];
        fillers.forEach(word => {
            clean = clean.split(word).join(' '); // Simple remove
        });
        
        // Fix specific phrases to Math.js format
        clean = clean.replace(/ plus /g, '+');
        clean = clean.replace(/ minus /g, '-');
        clean = clean.replace(/ times /g, '*');
        clean = clean.replace(/ divided by /g, '/');
        clean = clean.replace(/ to /g, ' to '); // Unit conversion
        clean = clean.replace(/ in /g, ' to '); // "in" acts as convert
        
        return clean.trim();
    }

    function setInput(val) {
        inputEl.value = val;
        inputEl.focus();
    }

    // 3. THE SOLVER ENGINE
    function solve() {
        let rawInput = inputEl.value;
        if (!rawInput) return;

        echoEl.innerText = "> " + rawInput;
        plotBox.style.display = 'none'; // Hide plot unless needed

        // Check for Plotting
        if (rawInput.toLowerCase().includes('plot')) {
            doPlot(rawInput);
            return;
        }

        try {
            // Step 1: Try Raw Input (Best for math syntax)
            let answer = parser.evaluate(rawInput);
            displayResult(answer);
        } catch (e1) {
            try {
                // Step 2: Try NLP Cleaning (Remove "what is", etc)
                let cleaned = cleanInput(rawInput);
                let answer = parser.evaluate(cleaned);
                displayResult(answer);
            } catch (e2) {
                // Step 3: FAIL SAFE
                displayFail(rawInput);
            }
        }
    }

    function displayResult(val) {
        if (typeof val === 'function') {
            resultEl.innerText = "Function Defined";
        } else if (typeof val === 'object' && val.toString) {
            resultEl.innerText = val.toString();
        } else {
            resultEl.innerText = math.format(val, { precision: 14 });
        }
    }

    function displayFail(query) {
        resultEl.innerHTML = "<span style='color:#ff4444; font-size:1.5rem'>Thinking...</span>";
        // Create a fallback link to WolframAlpha
        setTimeout(() => {
            resultEl.innerHTML = `
                <div style="font-size:1rem; color: #888">I can't calculate that locally.</div>
                <a href="https://www.wolframalpha.com/input?i=${encodeURIComponent(query)}" 
                   target="_blank" class="fallback-btn">
                   ðŸ‘‰ Search Universal Database
                </a>
            `;
        }, 500);
    }

    function doPlot(query) {
        try {
            // Extract formula: plot(x^2) -> x^2
            let formula = query.match(/\(([^)]+)\)/);
            if (!formula) formula = [0, query.replace('plot', '')]; // Fallback
            
            const expr = math.compile(formula[1]);
            const xValues = math.range(-10, 10, 0.1).toArray();
            const yValues = xValues.map(x => expr.evaluate({x: x}));

            plotBox.style.display = 'block';
            resultEl.innerText = "Graphing...";
            
            Plotly.newPlot('plot-box', [{
                x: xValues, y: yValues, type: 'scatter', mode: 'lines', line: {color: '#00ffa3'}
            }], {
                paper_bgcolor: '#000', plot_bgcolor: '#000',
                margin: { t: 20, r: 20, b: 30, l: 30 },
                font: { color: '#888' },
                xaxis: {gridcolor: '#222'}, yaxis: {gridcolor: '#222'}
            });
            resultEl.innerText = "";
        } catch (e) {
            resultEl.innerText = "Graph Error";
        }
    }

    inputEl.addEventListener('keypress', (e) => {
        if(e.key === 'Enter') solve();
    });
</script>
</body>
</html>
